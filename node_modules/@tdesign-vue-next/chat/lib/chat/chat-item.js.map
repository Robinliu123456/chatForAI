{"version":3,"file":"chat-item.js","sources":["../../src/chat/chat-item.tsx"],"sourcesContent":["import { defineComponent, computed, provide, inject, ref } from 'vue';\nimport props from './props';\n\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { useTNodeJSX } from '../hooks/tnode';\nimport Text from './chat-content';\nimport isString from 'lodash/isString';\nimport isArray from 'lodash/isArray';\nimport { Skeleton as TSkeleton, Button as TButton, Space as TSpace, Icon as TIcon } from 'tdesign-vue-next';\nimport ChatLoading from './chat-loading';\n\nexport default defineComponent({\n  name: 'TChatItem',\n  components: {\n    TSkeleton,\n    TButton,\n    TIcon,\n    TSpace,\n    Text,\n  },\n  props,\n  emits: ['operation'],\n  setup(props, { emit }) {\n    const COMPONENT_NAME = usePrefixClass('chat');\n    const renderTNodeJSX = useTNodeJSX();\n    const role = computed(() => renderTNodeJSX('role'));\n    const variant = computed(() => renderTNodeJSX('variant'));\n    // content为default时给子组件注入,模型切换时不注入数据，否则variant样式混乱\n    provide('role', role.value);\n    // 预留占位：t-chat注入textLoading和reverse\n    // const textLoading = inject('textLoading', props.textLoading);\n    // const reverse = inject('reverse', props.reverse);\n    return () => {\n      if (role.value === 'model-change') {\n        // modelChange 模式下，content支持html，样式有区分\n        const content = renderTNodeJSX('content');\n        const modelChangeDom = <div class={`${COMPONENT_NAME.value}__notice`} v-html={content}></div>;\n        return <div class={`${COMPONENT_NAME.value}__inner model-change`}>{modelChangeDom}</div>;\n      }\n      // 因为外层的role不能拿到实时更新的值，但是又要给子组件注入，所以这里单独另存了个变量\n      const roleValue = renderTNodeJSX('role');\n      const movable = renderTNodeJSX('movable');\n      const name = renderTNodeJSX('name');\n      const datetime = renderTNodeJSX('datetime');\n      const avatar = renderTNodeJSX('avatar');\n      const shownameDatetime = computed(() => name || datetime);\n      // shownameDatetime存在时，contentClasses有个padding-top\n      const contentClasses = computed(() => {\n        return shownameDatetime.value\n          ? [`${COMPONENT_NAME.value}__content`]\n          : [`${COMPONENT_NAME.value}__content`, `${COMPONENT_NAME.value}__content--base`];\n      });\n      const avatarDom = avatar ? (\n        <div class={`${COMPONENT_NAME.value}__avatar`}>\n          <div class={`${COMPONENT_NAME.value}__avatar__box`}>\n            {isString(avatar) ? <img src={avatar} alt=\"\" class={`${COMPONENT_NAME.value}__avatar-image`} /> : avatar}\n          </div>\n        </div>\n      ) : null;\n      const nameDatetimeDom = shownameDatetime.value && (\n        <div class={`${COMPONENT_NAME.value}__base`}>\n          {name && <span class={`${COMPONENT_NAME.value}__name`}>{name}</span>}\n          {datetime && <span class={`${COMPONENT_NAME.value}__time`}>{datetime}</span>}\n        </div>\n      );\n      // todo 结合reverse属性，倒序是第一个元素loading，倒序是最后一个元素loading\n      // const showLoad = props.itemIndex === 0 && textLoading && reverse;\n      const textLoading = props.textLoading;\n      const content = renderTNodeJSX('content');\n      // 内置操作按钮，assistantActions和插槽判断 t-chat注入的属性获取不到默认为false\n      const showActions = computed(() => renderTNodeJSX('actions'));\n      const contentDom = (\n        <>\n          {avatarDom}\n          <div class={contentClasses.value}>\n            {nameDatetimeDom}\n            {/* 骨架屏加载 */}\n            {textLoading && <t-skeleton loading={textLoading} animation={'gradient'}></t-skeleton>}\n            {/* 动画加载 skeleton：骨架屏 gradient：渐变加载动画一个点 dot：三个点 */}\n            {textLoading && movable && <ChatLoading loading={textLoading} animation={'gradient'}></ChatLoading>}\n            {!textLoading && (\n              <div class={`${COMPONENT_NAME.value}__detail`}>\n                {/* 自定义content插槽内容 */}\n                {isArray(content) ? content : <Text isNormalText={false} content={content} role={role.value} />}\n              </div>\n            )}\n            {role.value === 'assistant' && showActions.value && (\n              <div class={`${COMPONENT_NAME.value}__actions-margin`}>{renderTNodeJSX('actions')}</div>\n            )}\n          </div>\n        </>\n      );\n      return (\n        <div\n          class={`${COMPONENT_NAME.value}__inner ${roleValue} ${COMPONENT_NAME.value}__text--variant--${variant.value}`}\n        >\n          {contentDom}\n        </div>\n      );\n    };\n  },\n});\n"],"names":["defineComponent","name","components","TSkeleton","TButton","TIcon","TSpace","Text","props","emits","setup","_ref","emit","COMPONENT_NAME","usePrefixClass","renderTNodeJSX","useTNodeJSX","role","computed","variant","provide","value","content","modelChangeDom","_createVNode","concat","roleValue","movable","datetime","avatar","shownameDatetime","contentClasses","avatarDom","isString","nameDatetimeDom","textLoading","showActions","contentDom","_Fragment","ChatLoading","isArray"],"mappings":"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"}