{"version":3,"file":"chat-input.js","sources":["../../src/chat/chat-input.tsx"],"sourcesContent":["import { defineComponent, toRefs, computed } from 'vue';\nimport { RectangleIcon, SendIcon, StopCircleIcon } from 'tdesign-icons-vue-next';\nimport { useTNodeJSX } from '../hooks/tnode';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { Button as TButton, Row as TRow, Textarea as TTextarea, Loading as TLoading } from 'tdesign-vue-next';\nimport props from './props';\nimport useVModel from '../hooks/useVModel';\n\nexport default defineComponent({\n  name: 'TChatInput',\n  components: {\n    RectangleIcon,\n    SendIcon,\n    TButton,\n    TRow,\n    TTextarea,\n    TLoading,\n  },\n  props: {\n    modelValue: {\n      type: String,\n      default: '',\n    },\n    value: {\n      type: String,\n      default: '',\n    },\n    defaultValue: {\n      type: String,\n      default: '',\n    },\n    placeholder: {\n      type: String,\n      default: '请输入消息...',\n    },\n    stopDisabled: {\n      type: Boolean,\n      default: false,\n    },\n    disabled: {\n      type: Boolean,\n      default: false,\n    },\n    // 是否自动聚焦\n    autofocus: {\n      type: Boolean,\n      default: false,\n    },\n    autosize: props.autosize,\n    onSend: props.onSend,\n    onStop: props.onStop,\n    onChange: props.onChange,\n    onBlur: props.onBlur,\n    onFocus: props.onFocus,\n  },\n  emits: ['send', 'stop', 'update:modelValue', 'blur', 'focus'], // declare the custom events here\n  setup(props, { slots, emit }) {\n    const COMPONENT_NAME = usePrefixClass('chat');\n    const { value, modelValue } = toRefs(props);\n    const [textValue, setInnerValue] = useVModel(value, modelValue, props.defaultValue, props.onChange);\n    // 按钮禁用，\n    const disabled = computed(() => props.stopDisabled);\n    // textarea禁用，\n    const textareaDisabled = computed(() => props.disabled);\n    // 输入框是否自动聚焦\n    const autofocus = computed(() => props.autofocus);\n    // 输入框高度\n    const autosize = computed(() => props.autosize);\n    let shiftDownFlag = false;\n    let isComposition = false;\n    const renderTNodeJSX = useTNodeJSX();\n    const suffixIcon = renderTNodeJSX('suffixIcon') || slots.suffixIcon;\n    const sendClick = (e: MouseEvent | KeyboardEvent) => {\n      if (textValue.value && !disabled.value) {\n        emit('send', textValue.value, { e });\n        setInnerValue('', { e });\n      }\n    };\n\n    const handleStop = (e: MouseEvent) => {\n      emit('stop', textValue.value, {\n        e,\n      });\n    };\n\n    const textChange = (value: any, context: { e: InputEvent | MouseEvent }) => {\n      setInnerValue(value, context);\n    };\n    const blurFn = (value: any, context: { e: FocusEvent }) => {\n      emit('blur', value, context);\n    };\n    const focusFn = (value: any, context: { e: FocusEvent }) => {\n      emit('focus', value, context);\n    };\n    const keydownFn = (value: any, context: { e: KeyboardEvent }) => {\n      const {\n        e: { key },\n      } = context;\n      if (key === 'Shift') {\n        shiftDownFlag = true;\n      }\n      if (key === 'Enter' && !shiftDownFlag && !isComposition) {\n        context.e.cancelBubble = true;\n        context.e.preventDefault();\n        context.e.stopPropagation();\n        sendClick(context.e);\n      }\n    };\n\n    const keyupFn = (value: any, context: any) => {\n      const {\n        e: { key },\n      } = context;\n      if (key === 'Shift') {\n        shiftDownFlag = false;\n      }\n    };\n\n    const compositionstartFn = () => {\n      isComposition = true;\n    };\n\n    const compositionendFn = () => {\n      isComposition = false;\n    };\n    // 默认suffixIcon\n    const getDefaultSuffixIcon = () => {\n      // if (!stopBtn.value && disabled.value) {\n      //   return <t-loading />;\n      // } else {\n      return (\n        <t-button\n          theme=\"default\"\n          size=\"small\"\n          variant=\"text\"\n          class={[\n            `${COMPONENT_NAME.value}__footer__textarea__icon__default`,\n            textValue.value ? `${COMPONENT_NAME.value}__footer__textarea__icon--focus` : '',\n          ]}\n          disabled={disabled.value || !textValue.value || textareaDisabled.value}\n        >\n          <SendIcon />\n        </t-button>\n      );\n      // }\n    };\n    const renderSuffixIcon = () => {\n      return suffixIcon ? suffixIcon : getDefaultSuffixIcon();\n    };\n    return () => (\n      <div class={`${COMPONENT_NAME.value}__footer__content`}>\n        {/* textAreaBox */}\n        <div class={`${COMPONENT_NAME.value}__footer__textarea`}>\n          <t-textarea\n            value={textValue.value}\n            class=\"noscrollbar\"\n            placeholder={props.placeholder}\n            disabled={textareaDisabled.value}\n            autofocus={autofocus.value}\n            autosize={autosize.value}\n            onChange={textChange}\n            onBlur={blurFn}\n            onFocus={focusFn}\n            onKeydown={keydownFn}\n            onKeyup={keyupFn}\n            onCompositionstart={compositionstartFn}\n            onCompositionend={compositionendFn}\n          />\n          <div class={`${COMPONENT_NAME.value}__footer__textarea__icon`} onClick={sendClick}>\n            {renderSuffixIcon()}\n          </div>\n        </div>\n        {disabled.value && !textareaDisabled.value && (\n          <div class={`${COMPONENT_NAME.value}__footer__stopbtn`}>\n            <t-button variant=\"outline\" onClick={handleStop}>\n              <StopCircleIcon slot=\"icon\" />\n              中止\n            </t-button>\n          </div>\n        )}\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","components","RectangleIcon","SendIcon","TButton","TRow","TTextarea","TLoading","props","modelValue","type","String","value","defaultValue","placeholder","stopDisabled","Boolean","disabled","autofocus","autosize","onSend","onStop","onChange","onBlur","onFocus","emits","setup","slots","_ref","emit","COMPONENT_NAME","usePrefixClass","_toRefs","toRefs","_useVModel","useVModel","_useVModel2","_slicedToArray","textValue","setInnerValue","computed","textareaDisabled","shiftDownFlag","isComposition","renderTNodeJSX","useTNodeJSX","suffixIcon","sendClick","e","handleStop","textChange","context","blurFn","focusFn","keydownFn","key","cancelBubble","preventDefault","stopPropagation","keyupFn","compositionstartFn","compositionendFn","getDefaultSuffixIcon","_createVNode","_resolveComponent","concat","_default","renderSuffixIcon","StopCircleIcon"],"mappings":"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"}